% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/transformations.R
\name{transform_matrix}
\alias{transform_matrix}
\title{Transform each column of matrix using final FP powers or ACD transformation}
\usage{
transform_matrix(
  x,
  power_list,
  center,
  acdx,
  keep_x_order = FALSE,
  acd_parameter_list = NULL,
  check_binary = TRUE,
  zero = NULL,
  catzero = NULL,
  spike_decision = NULL,
  reset_zero = TRUE
)
}
\arguments{
\item{x}{a matrix with all continuous variables shifted and scaled.}

\item{power_list}{a named list of FP powers to be applied to the columns of
\code{x}. Only variables named in this list are transformed.}

\item{center}{a named logical vector specifying whether the columns in \code{x}
should be centered. Centering will occur after transformations and will be
done separately for each individual column of the transformed data matrix.}

\item{acdx}{a named logical vector specifying the use of acd transformation.}

\item{keep_x_order}{a logical indicating whether the order of columns
should be kept as in the input matrix \code{x}, of if the columns should be
ordered according to \code{power_list}. The default is \code{FALSE}, since
the ordering by \code{power_list} reflects the \code{xorder} argument in \code{\link[=mfp2]{mfp2()}}.}

\item{acd_parameter_list}{a named list. Only required when transformation
are to be applied to new data. Entries must correspond to the entries where
\code{acdx} is set to \code{TRUE}. Each components is to be passed to
\code{\link[=transform_vector_acd]{transform_vector_acd()}}. The default value \code{NULL} indicates that the
parameters for the acd transformations are to be estimated.}

\item{check_binary}{passed to \code{\link[=transform_vector_fp]{transform_vector_fp()}}.}

\item{zero}{A named logical vector specifying, for each variable, whether only
positive values should be transformed. If \code{TRUE}, the transformation is applied
only to positive values; nonpositive values (zero or negative) are replaced with zero.
If \code{FALSE}, all values are used (after shifting, if necessary).
Variable names must match the corresponding column names in \code{x}. The default
is \code{NULL}, meaning no variables are treated as zero-transformed.}

\item{catzero}{A named logical vector similar to \code{zero}, indicating which
columns in \code{x} should treat nonpositive values as zero and additionally have a
binary indicator created and included in the model. The vector must have names matching
the column names in \code{x}. The default is \code{NULL}, meaning no categorical-zero
variables are used.}

\item{spike_decision}{Named numeric vector with values 1, 2, or 3 specifying
spike-at-zero handling for each variable. Default is \code{NULL}, meaning no
spike-at-zero processing is applied. Value 1 includes both the transformed
variable and binary indicator, 2 disables the spike/binary indicator, and 3
keeps only the binary indicator.}

\item{reset_zero}{Logical. If \code{TRUE} (default), variables incorrectly flagged
as \code{zero = TRUE} but containing only positive values are reset to \code{FALSE}.}
}
\value{
If all elements of \code{power_list} are \code{NA}, returns \code{NULL}. Otherwise,
returns with the following components:
\itemize{
\item \code{x_transformed}: matrix of transformed (and optionally centered) variables.
The number of columns may differ from the input matrix due to
higher-order FP transformations. Binary variables are also added if
\code{catzero} is not \code{NULL}.
\item \code{centers}: values used for centering, if \code{center = TRUE} (typically all
variables are centered, or none of them).
\item \code{acd_parameter}: a named list of estimated ACD parameters, which may be
empty if no ACD transformation is applied.
\item \code{x_trafo}: list of transformed variables before centering and adding
binary variables when \code{catzero = TRUE}. This is important for the
spike-at-zero algorithm.
\item \code{zero_expanded}: logical vector indicating, for each transformed column,
whether zero-specific centering was applied (this may be \code{TRUE} even when
no spike-at-zero processing is used). This is important for centering
transformed variables via \code{center_matrix}.
}
}
\description{
This function applies FP and/or ACD transformations to the columns of a matrix,
optionally centers the transformed variables, and can generate binary indicators
for variables with nonpositive values (catzero). The spike-at-zero variables
is supported via the \code{spike_decision} argument.
}
\details{
For details on the transformations see \code{\link[=transform_vector_fp]{transform_vector_fp()}} and
\code{\link[=transform_vector_acd]{transform_vector_acd()}}.

Transformations are handled by \code{\link[=transform_vector_fp]{transform_vector_fp()}} and \code{\link[=transform_vector_acd]{transform_vector_acd()}}.
The \code{x_transformed} matrix contains transformed variables, optionally centered.
Binary indicators are appended if specified in \code{catzero}.
The \code{spike_decision} argument controls spike-at-zero (SAZ) processing: for variables
with value 2, the binary indicator is disabled reducing to usual transformations;
for variables with value 3, only the binary indicator of SAZ is retained and
any FP/linear transformations are removed. This ensures correct handling
of variables with SAZ.

\strong{Centering:}
\itemize{
\item For continuous variables, the mean of the transformed values is subtracted.
\item For binary variables, centering uses the minimum (typically 0).
\item If \code{zero = TRUE}, the mean is computed only over the positive transformed values,
while the original zero entries are left at zero. This preserves the spike-at-zero
alignment on the original scale.
\item Columns corresponding to \code{catzero} binary indicators are left as 0/1 in the
returned matrix; their centering value is \code{0} in the current implementation,
so the centering step does not change those columns. If you prefer mean-centering
of the binary indicators (subtracting their sample proportion), supply explicit
\code{centers} or post-process the returned matrix.
}
}
\section{Column names}{

Transformed variable names are based on the original names. FP terms are
suffixed with ".i" to indicate the power index for that variable. Variables
transformed using ACD are prefixed with "A_". Binary indicators created
for nonpositive values (catzero) are suffixed with "_bin".
}

\examples{
x = matrix(1:100, nrow = 10)
colnames(x) = paste0("x", 1:ncol(x))
powx = setNames(replicate(ncol(x), c(1,2), simplify = FALSE), colnames(x))
center = setNames(rep(FALSE, ncol(x)), colnames(x))
acdx = setNames(rep(FALSE, ncol(x)), colnames(x))
transform_matrix(x, powx, center, acdx)

}
