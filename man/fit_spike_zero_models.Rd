% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mfp_step.R
\name{fit_spike_zero_models}
\alias{fit_spike_zero_models}
\title{Fit Candidate Models for Stage 2 of the Spike-at-Zero Algorithm}
\usage{
fit_spike_zero_models(
  x,
  xi,
  y,
  weights,
  offset,
  family,
  method,
  strata,
  nocenter,
  control,
  rownames,
  powers_current,
  powers,
  acdx,
  zero,
  catzero,
  power_best,
  spike_decision,
  acd_parameter
)
}
\arguments{
\item{x}{an input matrix of dimensions nobs x nvars. Does not contain
intercept, but columns are already expanded into dummy variables as
necessary. Data are assumed to be shifted and scaled.}

\item{xi}{a character string indicating the name of the current variable
of interest, for which the best fractional polynomial transformation is
to be estimated in the current step.}

\item{y}{a vector for the response variable or a \code{Surv} object.}

\item{weights}{a vector of observation weights of length nobs.}

\item{offset}{a vector of length nobs of offsets.}

\item{family}{a character string representing a family object.}

\item{method}{a character string specifying the method for tie handling in
Cox regression.}

\item{strata}{a factor of all possible combinations of stratification
variables. Returned from \code{\link[survival:strata]{survival::strata()}}.}

\item{nocenter}{a numeric vector with a list of values for fitting Cox
models. See \code{\link[survival:coxph]{survival::coxph()}} for details.}

\item{control}{a list with parameters for model fit.}

\item{rownames}{a parameter for Cox models.}

\item{powers_current}{a list of length equal to the number of variables,
indicating the fp powers to be used in the current step for all variables
(except \code{xi}).}

\item{powers}{a named list of numeric values that sets the permitted FP
powers for each covariate.}

\item{acdx}{a logical vector of length nvars indicating continuous variables
to undergo the approximate cumulative distribution (ACD) transformation.}

\item{zero}{A named logical vector indicating, which columns of
\code{x} should treat nonpositive values (zero or negative) as zero before
transformation. Must be the same length as the columns of \code{x}.}

\item{catzero}{A named list of binary indicator variables of length \code{ncol(x)}
for nonpositive values, created when specific variables are passed to the
\code{catzero} argument of \code{fit_mfp}. If an element of the list is
\code{NULL}, it indicates that the corresponding variable was not specified by
the user in the \code{catzero} argument of \code{fit_mfp}. Here, \code{catzero}
is a list of binary variables, not a named logical vector as in \code{fit_mfp}.}

\item{spike_decision}{Named vector indicating how spike-at-zero (SAZ)
variables are handled. Each element corresponds to a variable and encodes
the selected strategy: \code{1} = include FP for positive values plus binary SAZ,
\code{2} = treat as continuous FP only, \code{3} = include binary SAZ only.}

\item{acd_parameter}{Named list of ACD parameters produced by \code{\link[=fit_acd]{fit_acd()}},
with length equal to \code{ncol(x)}. Each list element corresponds to a variable;
if an element is \code{NULL}, the variable was not specified in the
\code{acdx} argument of \code{fit_mfp}.}
}
\value{
A list with the following elements:
\itemize{
\item \code{fit2}: Model 2 fit (FPm/linear only + adjusted covariates).
\item \code{fit3}: Model 3 fit (binary only + adjusted covariates).
\item \code{x_transformed}: List containing transformed predictor matrices.
}
}
\description{
This function fits the two candidate regression models required for stage 2
of the spike-at-zero (SAZ) algorithm. Stage 2 ideally considers three models
(Model 1: complex, Model 2: FPm/linear only, Model 3: binary only), but
Model 1 is already fitted in stage 1. This function therefore fits Model 2,
which includes fractional polynomial/linear terms plus adjusted covariates,
and Model 3, which includes binary-only terms plus adjusted covariates.
}
\details{
The function performs the following steps: First, it transforms the predictors
according to selected FP powers and other adjustments. Second, it fits models
2 and 3 for comparison. Then returns both model fits (\code{fit2} and \code{fit3}) and
the transformed predictor structure.
}
\keyword{internal}
