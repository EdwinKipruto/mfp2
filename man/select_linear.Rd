% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/mfp_step.R
\name{select_linear}
\alias{select_linear}
\title{Helper function to select between null and linear term for a single variable}
\usage{
select_linear(
  x,
  xi,
  keep,
  degree,
  acdx,
  y,
  powers_current,
  powers,
  criterion,
  ftest,
  select,
  alpha,
  family,
  zero,
  catzero,
  spike,
  spike_decision,
  acd_parameter,
  ...
)
}
\arguments{
\item{x}{an input matrix of dimensions nobs x nvars. Does not contain
intercept, but columns are already expanded into dummy variables as
necessary. Data are assumed to be shifted and scaled.}

\item{xi}{a character string indicating the name of the current variable
of interest, for which the best fractional polynomial transformation is
to be estimated in the current step.}

\item{keep}{a character vector with names of variables to be kept
in the model.}

\item{degree}{not used.}

\item{acdx}{a logical vector of length nvars indicating continuous variables
to undergo the approximate cumulative distribution (ACD) transformation.}

\item{y}{a vector for the response variable or a \code{Surv} object.}

\item{powers_current}{a list of length equal to the number of variables,
indicating the fp powers to be used in the current step for all variables
(except \code{xi}).}

\item{powers}{a named list of numeric values that sets the permitted FP
powers for each covariate.}

\item{criterion}{a character string defining the criterion used to select
variables and FP models of different degrees.}

\item{ftest}{a logical indicating the use of the F-test for Gaussian models.}

\item{select}{a numeric value indicating the significance level
for backward elimination of \code{xi}.}

\item{alpha}{a numeric value indicating the significance level
for tests between FP models of different degrees for \code{xi}.}

\item{family}{a character string representing a family object.}

\item{zero}{A named logical vector indicating, which columns of
\code{x} should treat nonpositive values (zero or negative) as zero before
transformation. Must be the same length as the columns of \code{x}.}

\item{catzero}{A named list of binary indicator variables of length \code{ncol(x)}
for nonpositive values, created when specific variables are passed to the
\code{catzero} argument of \code{fit_mfp}. If an element of the list is
\code{NULL}, it indicates that the corresponding variable was not specified by
the user in the \code{catzero} argument of \code{fit_mfp}. Here, \code{catzero}
is a list of binary variables, not a named logical vector as in \code{fit_mfp}.}

\item{spike}{A logical vector indicating which columns of \code{x} contain
a spike at zero. The length and order of \code{spike} must match those of
the columns in \code{x}.}

\item{spike_decision}{Named vector indicating how spike-at-zero (SAZ)
variables are handled. Each element corresponds to a variable and encodes
the selected strategy: \code{1} = include FP for positive values plus binary SAZ,
\code{2} = treat as continuous FP only, \code{3} = include binary SAZ only.}

\item{acd_parameter}{Named list of ACD parameters produced by \code{\link[=fit_acd]{fit_acd()}},
with length equal to \code{ncol(x)}. Each list element corresponds to a variable;
if an element is \code{NULL}, the variable was not specified in the
\code{acdx} argument of \code{fit_mfp}.}

\item{...}{passed to fitting functions.}
}
\value{
A list with several components:
\itemize{
\item \code{keep}: logical indicating if \code{xi} is forced into model.
\item \code{acd}: logical indicating if an ACD transformation was applied for \code{xi}.
\item \code{powers}: fp powers investigated in step, indexing \code{metrics}.
\item \code{power_best}: a numeric vector with the best power found. The returned
best power may be \code{NA}, indicating the variable has been removed from the
model.
\item \code{metrics}: a matrix with performance indices for all models investigated.
Same number of rows as, and indexed by, \code{powers}.
\item \code{model_best}: row index of best model in \code{metrics}.
\item \code{pvalue}: p-value for comparison of linear and null model.
\item \code{statistic}: test statistic used, depends on \code{ftest}.
\item \code{zero}: Logical indicating whether a zero transformation was applied to \code{xi}.
In this case, nonpositive values of \code{xi} were set to zero before transformation,
and only positive values were transformed.
\item \code{catzero}: Logical indicating whether a combination of a zero transformation
and a binary indicator variable was applied to \code{xi}. This means that
nonpositive values of \code{xi} were set to zero, only positive values were
transformed, and an additional binary variable was created to indicate
whether \code{xi} was positive or nonpositive.
}
}
\description{
To be used in \code{\link[=find_best_fp_step]{find_best_fp_step()}}. Only used if \code{df = 1} for a variable.
Handles all criteria for selection.
For parameter explanations, see \code{\link[=find_best_fp_step]{find_best_fp_step()}}. All parameters
captured by \code{...} are passed to \code{\link[=fit_model]{fit_model()}}.
}
\details{
This function assesses a single variable of interest \code{xi} regarding its
functional form in the current working model as indicated by
\code{powers_current}, with the choice between excluding \code{xi} ("null model") and
including a linear term ("linear fp") for \code{xi}.

Note that this function handles an ACD transformation for \code{xi} as well.

When a variable is forced into the model by including it in \code{keep}, then
this function will not exclude it from the model (by setting its power to
\code{NA}), but will only choose the linear model.
}
